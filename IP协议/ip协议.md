# ip协议



![image-20200916141018561](G:\Markdown\IP协议\ip协议.assets\image-20200916141018561.png)



# UDP

- UDP是一个面向数据报的协议
- 



# TCP

- TCP是一个面向连接的协议
- TCP是点到点的通信
- TCP提供可靠的传输服务
- TCP提供全双工的通信TCP是面向字节流的协议
- 

![image-20200916144453591](G:\Markdown\IP协议\ip协议.assets\image-20200916144453591.png)





# 可靠性传输理论

## **停止等待协议**

发送方发送消息, 接收方收到之后返回确认收到,  发送方收到之后, 再发送第二份消息;

收到确认, 超时重传

## **超时定时器**

超时重传





## **连续ARQ协议**



- 滑动窗口,  窗口内的消息都可以依次发送, 最先发送的收到确认消息之后, 就往前滑动窗口, 继续发送新加入窗口中的消息, 
- 累计确认, 比如说收到5号消息的确认信息, 就认为5之前的消息全部都被收到了, 窗口直接大幅度往前推, 这样可以减少确认报文的数量, 等于是间隔确认, 依次来提高效率

![image-20200916150416515](G:\Markdown\IP协议\ip协议.assets\image-20200916150416515.png)

# TCP协议的可靠传输

- tcp的可靠传输是基于ARQ协议的
- tcp的滑动窗口以字节为单位, 比如13个字节, 13个格子



![image-20200916151137778](G:\Markdown\IP协议\ip协议.assets\image-20200916151137778.png)

![image-20200916151257288](G:\Markdown\IP协议\ip协议.assets\image-20200916151257288.png)

- 选择重传 需要指定需要重传的消息序号, 重传的序号并不是指某一个字节, 而是某一个范围, 因为可能整个报文都丢掉了

# TCP协议的流量控制

接收方希望发送方发的慢一些,让发送方发送速率不要太快

- 是使用滑动窗口来实现的

## 坚持定时器

接收方会返回给发送方一个当前可接受数据窗口大小, 如果为0

当之前的数据处理完之后, 会给发送方发送一个新的可接受数据窗口大小, 但是为了防止这条信息丢失.

则发送方会开启坚持定时器, 每过一段时间就发送一个窗口探测报文询问接收方



# TCP协议的拥塞控制

一条数据链路经过非常多的设备

数据链路中各个部分都有可能成为网络传输的瓶颈

**流量控制考虑点对点的通信量**

**拥塞控制考虑整个网络,是全局性的考虑**

- 报文超时则认为是拥塞



- 慢启动算法
  - 有小到大主键增加发送数据量
  - 每收到一个报文确认, 就+1是如 1 2 4 8 16这样的
  - 增长到慢启动阈值就不增长了   然后**会启动下面的拥塞避免算法**
- 拥塞避免算法
  - 维护一个拥塞窗口的变量
  - 只要网络不拥塞, 就试探着将拥塞窗口调大, 17 18 19...

![image-20200916164244339](G:\Markdown\IP协议\ip协议.assets\image-20200916164244339.png)



# TCP连接的建立 三次握手

![image-20200916164820508](G:\Markdown\IP协议\ip协议.assets\image-20200916164820508.png)



SYN 连接请求的意思

ACK 对连接双方的序列号进行同步



## 为什么要三次握手

避免已经失效的连接请求报文传送到对方,引起错误

![image-20200916165242818](G:\Markdown\IP协议\ip协议.assets\image-20200916165242818.png)发送方会忽略掉第二次返回的请求连接消息, 这样就可以避免与失效引发不应该有的错误

# TCP连接的释放 四次挥手

![image-20200916165729257](G:\Markdown\IP协议\ip协议.assets\image-20200916165729257.png)

## 等待计时器

等待计时器会等待2MSL的时间, 两倍的最长报文段的时间, 两倍就是4分钟, 这个时间它不会释放占用的端口

- 为什么需要等待2MSL
  - 最后一个报文没有确认
  - 确保发送方的ACK可以到达接收方
  - 2MSL时间内没有收到,则接收方会重发释放连接的请求  第三次挥手
  - 然后发送方再重发 第四次挥手
  - 确保当前连接的所有报文都过期了





# 套接字Socket和套接字编程

使用端口port来标记不同的网络进程

端口port使用16比特位表示0-65535

{ip:port}  就叫做套接字也叫Socket

socket是抽象概念,表示TCP连接其中的一端

通过套接字可以进行数据的发送和接收

TCP={socket1:socket2}  TCP={{ip:port} :{ip:port} }  表示一条唯一的连接

一个ip可以有多个套接字, 和不同的端口组合就是不同的套接字



![image-20200916171823559](G:\Markdown\IP协议\ip协议.assets\image-20200916171823559.png)

